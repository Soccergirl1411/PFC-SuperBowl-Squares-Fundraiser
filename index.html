<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PFC 2009 Boys - Superbowl Squares</title>
    <style>
        :root { 
            --pats-blue: #002244; --pats-red: #C60C30; --pats-silver: #B0B7BC;
            --hawks-navy: #002244; --hawks-green: #69BE28;
            --nfl-dark: #010101; --selection-yellow: #FFB81C;
            --stadium-dark: #0f172a;
        }
        
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: var(--stadium-dark); margin: 0; padding: 0 0 200px 0; color: #f8fafc; text-align: center; }
        
        .hero-section { 
            background: radial-gradient(circle at center, #1e293b 0%, #010101 100%); 
            color: white; padding: 60px 15px; border-bottom: 5px solid var(--hawks-green); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
        }
        .team-brand { font-weight: 900; color: var(--hawks-green); letter-spacing: 3px; font-size: 20px; text-transform: uppercase; margin-bottom: 5px; }
        .hero-section h1 { font-size: clamp(2.2rem, 8vw, 3.8rem); margin: 5px 0; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; }
        
        .sync-container { display: flex; justify-content: center; align-items: center; margin-top: 10px; }
        #sync-time { font-size: 12px; color: #94a3b8; font-weight: 600; }
        
        .btn-refresh { 
            background: rgba(105, 190, 40, 0.1); border: 1px solid var(--hawks-green); 
            color: var(--hawks-green); padding: 4px 12px; border-radius: 20px; 
            cursor: pointer; font-size: 10px; margin-left: 10px; font-weight: 700; 
            transition: 0.3s; text-transform: uppercase;
        }

        #game-countdown { 
            display: inline-block; margin-top: 15px; padding: 8px 25px; background: rgba(198, 12, 48, 0.2); 
            border: 1px solid var(--pats-red); border-radius: 50px; font-weight: 800; 
            color: white; letter-spacing: 1px; font-size: 0.9rem; line-height: 1.4;
        }
        
        .timer-highlight { color: var(--selection-yellow); }

        .container { 
            max-width: 1100px; 
            margin: -30px auto 0 auto; 
            width: 95%; 
            background: white; 
            padding: 30px; 
            border-radius: 20px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.6); 
            text-align: left; 
            box-sizing: border-box; 
            color: #1e293b; 
            overflow: hidden; 
        }

        @media (max-width: 600px) {
            .container { width: 98%; padding: 15px 10px; }
        }

        .info-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        @media (max-width: 850px) { .info-grid { grid-template-columns: 1fr; } }
        
        .info-card { background: #f8fafc; padding: 20px; border-radius: 12px; border-top: 4px solid var(--pats-blue); box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .info-card h4 { margin: 0 0 10px 0; font-size: 14px; letter-spacing: 1px; color: var(--pats-red); text-transform: uppercase; }
        
        .how-to-win-navy { background: var(--hawks-navy); color: white; padding: 25px; border-radius: 12px 12px 0 0; border-left: 8px solid var(--hawks-green); margin-bottom: 0; }
        .how-to-win-navy h4 { margin: 0 0 15px 0; color: var(--hawks-green); font-size: 22px; text-transform: uppercase; }
        .axis-list { list-style: none; padding: 0; margin: 15px 0; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px;}
        .digit-highlight { color: var(--selection-yellow); font-size: 20px; text-decoration: underline; font-weight: 900; }
        
        .second-chance-bar { 
            background: #fffbeb; border: 2px dashed var(--selection-yellow); 
            color: #92400e; padding: 15px; border-radius: 0 0 12px 12px; 
            font-size: 16px; font-weight: 700; margin-top: 20px; margin-bottom: 30px; text-align: center; 
        }

        .pot-tracker { display: flex; justify-content: space-around; gap: 15px; margin: 25px 0 35px 0; border-top: 1px solid #e2e8f0; border-bottom: 1px solid #e2e8f0; padding: 20px 0; }
        .pot-card { text-align: center; flex: 1; }
        .pot-card span { font-size: 32px; font-weight: 900; color: var(--pats-blue); }

        .game-wrapper { display: flex; flex-direction: column; align-items: center; margin-top: 20px; width: 100%; }
        
        .hawks-banner { 
            width: calc(100% - 40px); 
            margin-left: 40px; 
            background: var(--hawks-navy); 
            color: var(--hawks-green); 
            font-weight: 900; 
            padding: 12px 0; 
            text-align: center; 
            border-radius: 8px 8px 0 0; 
            border-bottom: 4px solid var(--hawks-green); 
            font-size: clamp(12px, 2.5vw, 18px);
            box-sizing: border-box;
            text-transform: uppercase;
        }

        .main-row { display: flex; width: 100%; justify-content: center; }
        
        .pats-banner { 
            writing-mode: vertical-rl; 
            transform: rotate(180deg); 
            background: var(--pats-blue); 
            color: white; 
            width: 40px; 
            flex-shrink: 0; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-weight: 900; 
            text-align: center; 
            border-radius: 8px 0 0 8px; 
            border-right: 4px solid var(--pats-red); 
            font-size: clamp(12px, 2.5vw, 18px);
            text-transform: uppercase;
        }

        @media (max-width: 600px) {
            .hawks-banner { margin-left: 30px; width: calc(100% - 30px); padding: 8px 0; }
            .pats-banner { width: 30px; }
        }
        
        .grid { 
            display: grid; 
            grid-template-columns: repeat(11, 1fr); 
            gap: 1px;
            background: #cbd5e1; 
            width: 100%; 
            max-width: 100%; 
            padding: 2px;
            box-sizing: border-box; 
        }

        .sq { 
            aspect-ratio: 1; 
            background: white; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: clamp(10px, 2.5vw, 20px); 
            font-weight: 800; 
            cursor: pointer; 
            color: #1e293b; 
            border-radius: 2px; 
            min-width: 0; 
            overflow: hidden; 
            text-overflow: ellipsis;
        }

        .axis-sq { background: #f8fafc; color: var(--pats-blue); font-weight: 900; cursor: default; font-size: clamp(14px, 3vw, 22px); }
        .taken { background: #f1f5f9; color: #94a3b8; cursor: not-allowed; }
        .selected { background: var(--selection-yellow) !important; color: black !important; }

        #checkout-bar { 
            position: fixed; bottom: 0; left: 0; right: 0; background: var(--nfl-dark); 
            color: white; padding: 15px 10px; text-align: center; z-index: 1000; 
            display: none; border-top: 4px solid var(--hawks-green); 
            box-shadow: 0 -10px 30px rgba(0,0,0,0.5);
        }
        .input-field { padding: 10px; margin: 5px; border-radius: 8px; border: 1px solid #334155; width: 44%; font-size: 15px; color: #000; }
        .btn-confirm { background: var(--hawks-green); color: white; padding: 12px 20px; border-radius: 10px; font-weight: 900; border: none; cursor: pointer; font-size: 16px; width: 92%; max-width: 400px; transition: 0.3s; margin-top: 5px; }
        
        @media (max-width: 600px) {
            body { padding-bottom: 260px; } 
            .input-field { width: 90%; margin: 4px 0; }
            #checkout-bar { padding: 12px 5px; }
        }

        #loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 9999; color: var(--hawks-green); font-weight: 800; font-size: 24px; }
    </style>
</head>
<body>

<div id="loading-overlay">SYNCING BOARD</div>

<div class="hero-section">
    <div class="team-brand">PFC 2009 BOYS FUNDRAISER</div>
    <h1>SUPERBOWL SQUARES</h1>
    <div class="sync-container">
        <span id="sync-time">Connecting...</span>
        <button onclick="loadBoard()" class="btn-refresh">üîÑ REFRESH BOARD</button>
    </div>
    <div id="game-countdown">LOADING WORLD CLOCK...</div>
</div>

<div class="container">
    <div class="info-grid">
        <div class="info-card">
            <h4>üí∞ RESERVE & PAY</h4>
            <p><b>$20.00 Per Square.</b></p>
            <p>1. Click the square and add the information then pay via e-transfer</p>
            <p style="font-weight: 800; margin: 15px 0;">OR</p>
            <p>2. In message box of your e-transfer please indicate the square.</p>
            <p><b>Payment confirms your reservation about the square.</b></p>
            <div style="background:#e2e8f0; padding:5px; margin-top:10px; font-weight:800; text-align:center; border-radius:4px; font-size:12px;">PFCBOYS09@GMAIL.COM</div>
        </div>
        <div class="info-card">
            <h4>üèüÔ∏è THE GAME BOARD</h4>
            <p><b>The game board</b> includes 100 squares for players to select.</p><br>
            <p><b>The Question Marks (?)</b> are row/column identifiers; these will be randomly assigned 0-9 before kickoff to determine the winner.</p>
        </div>
        <div class="info-card">
            <h4>üèÜ PRIZES</h4>
            <p>50% to Team / 50% to Prizes. Winners: <b>Q1, Q2, Q3, & Final Score.</b></p>
        </div>
    </div>

    <div class="how-to-win-navy">
        <h4>üèÖ HOW TO WIN</h4>
        <p><b>Last digit of the score for each team.</b> At the end of each quarter, we match the <b>Last Digit</b> of each team's score to the grid. Where they intersect is the winning square.</p>
        <ul class="axis-list">
            <li><b>Row Number:</b> The Last Digit of the New England Patriots score.</li>
            <li><b>Column Number:</b> The Last Digit of the Seattle Seahawks score.</li>
        </ul>
        <div style="font-size: 15px; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1); font-weight: 600; color: #cbd5e1;">
            <b>EXAMPLE:</b> If the score is New England Patriots 1<span class="digit-highlight">7</span> and Seattle Seahawks 1<span class="digit-highlight">4</span>, the winner is where <span class="digit-highlight">Row 7 and Column 4 intersect</span> on the grid.
        </div>
    </div>
    
    <div class="second-chance-bar">üì¢ SECOND CHANCE: If a winning square is unsold, the prize is RAFFLED to all paid participants!</div>

    <div class="pot-tracker">
        <div class="pot-card"><small>TOTAL PRIZE POOL</small><br><span id="total-pot">$0.00</span></div>
        <div class="pot-card"><small>PAYOUT PER WINNER</small><br><span id="quarter-payout">$0.00</span></div>
    </div>

    <div class="game-wrapper">
        <div class="hawks-banner">SEATTLE SEAHAWKS (COLUMNS)</div>
        <div class="main-row">
            <div class="pats-banner">NEW ENGLAND PATRIOTS (ROWS)</div>
            <div id="game-board" class="grid"></div>
        </div>
    </div>

    <div style="background: #f8fafc; padding: 20px; border-radius: 12px; margin-top: 40px; text-align: center; border-left: 5px solid #69BE28; border-right: 5px solid #C60C30; font-family: sans-serif; color: #1e293b;">
        <p><b style="display: block; margin-bottom: 5px;">Thank you for supporting the PFC 2009 Boys!</b>
        Proceeds directly support team development, travel, and season costs.</p>
    </div>
</div>

<div id="checkout-bar">
    <div style="margin-bottom:8px; font-weight: 800; font-size: 1rem;">
        Selected: <span id="checkout-count" style="color:var(--hawks-green)">0</span> | 
        Total: <span id="checkout-total" style="color:var(--selection-yellow)">$0.00</span>
    </div>
    <input type="text" id="userName" class="input-field" placeholder="Full Name (Displayed)">
    <input type="email" id="userEmail" class="input-field" placeholder="Email Address (Private)">
    <br>
    <button onclick="submitBooking()" class="btn-confirm">CONFIRM AND RESERVE</button>
</div>

<script>
    /* --- SECURE CONFIGURATION --- */
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzHUIWFce4Xb1HI3nW1toacZiEI4HK6nfsph5oZovGslcdhkOZMaVj_vcT8rPGrE6qd/exec"; 
    const SECRET_API_KEY = "PFC_SECURE_KEY_2026"; 

    const kickoffTime = new Date("February 8, 2026 18:30:00 EST").getTime();
    let selectedSquares = []; 
    let takenSquares = {}; 
    let seahawksNumbers = Array(10).fill("?"); 
    let patsNumbers = Array(10).fill("?"); 
    let gameLocked = false; 
    let worldTimeOffset = 0; 
    let clickCount = 0;

    function formatName(str) { 
        if (!str) return ""; 
        let parts = str.trim().split(" "); 
        return parts.length > 1 ? parts[0] + " " + parts[parts.length - 1].charAt(0) + "." : parts[0].substring(0, 10); 
    }

    async function syncTime() { 
        try { 
            const res = await fetch('https://worldtimeapi.org/api/timezone/America/New_York'); 
            const data = await res.json(); 
            worldTimeOffset = new Date(data.datetime).getTime() - new Date().getTime(); 
        } catch (e) { console.log("Clock fallback"); } 
    }
    
    async function loadBoard() { 
        document.getElementById('loading-overlay').style.display = 'flex'; 
        try { 
            const res = await fetch(SCRIPT_URL); 
            const data = await res.json(); 
            takenSquares = {}; 
            data.forEach(row => { 
                if(row[0] === "SEAHAWKS_NUMS") seahawksNumbers = JSON.parse(row[1]); 
                else if(row[0] === "PATS_NUMS") patsNumbers = JSON.parse(row[1]); 
                else if(row[0] && row[1] && !isNaN(row[0])) takenSquares[row[0].toString()] = row[1]; 
            }); 
            gameLocked = (seahawksNumbers[0] !== "?"); 
            renderBoard(); 
            document.getElementById('sync-time').innerText = `Last Sync: ${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', hour12: true })}`;
        } catch (e) { alert("Error connecting to board."); } 
        finally { document.getElementById('loading-overlay').style.display = 'none'; } 
    }

    function renderBoard() { 
        const board = document.getElementById('game-board'); 
        board.innerHTML = ""; 
        const fb = createSq("üèà", "axis-sq");
        fb.style.cursor = "pointer"; 
        fb.onclick = () => { clickCount++; if(clickCount === 5) adminAuth(); }; 
        board.appendChild(fb); 
        for (let i = 0; i < 10; i++) board.appendChild(createSq(seahawksNumbers[i], "axis-sq", 'var(--hawks-green)')); 
        let idCounter = 1; 
        for (let i = 0; i < 10; i++) { 
            board.appendChild(createSq(patsNumbers[i], "axis-sq", 'var(--pats-red)')); 
            for (let j = 0; j < 10; j++) { 
                const id = idCounter.toString(); 
                const buyer = takenSquares[id]; 
                const d = createSq(buyer ? formatName(buyer) : id, buyer ? 'taken' : ''); 
                d.id = id; 
                d.onclick = () => toggleSquare(id, !!buyer); 
                board.appendChild(d); 
                idCounter++; 
            } 
        } 
        updatePot(); 
    }

    function toggleSquare(id, taken) { 
        if (gameLocked) { alert("üèà THE GAME IS LOCKED üèà\nKickoff has started!"); return; } 
        if (taken) return; 
        const el = document.getElementById(id); 
        if (selectedSquares.includes(id)) { 
            selectedSquares = selectedSquares.filter(s => s !== id); 
            el.classList.remove('selected'); 
        } else { 
            selectedSquares.push(id); 
            el.classList.add('selected'); 
        } 
        updateCheckoutUI();
    }

    function updateCheckoutUI() {
        const bar = document.getElementById('checkout-bar');
        if (selectedSquares.length > 0) {
            bar.style.display = 'block';
            document.getElementById('checkout-count').innerText = selectedSquares.length;
            document.getElementById('checkout-total').innerText = `$${selectedSquares.length * 20}`;
        } else {
            bar.style.display = 'none';
        }
    }

    async function submitBooking() {
        const name = document.getElementById('userName').value.trim();
        const email = document.getElementById('userEmail').value.trim();
        if (!name || !email) return alert("Please enter both Name and Email Address.");
        const overlay = document.getElementById('loading-overlay');
        overlay.style.display = 'flex'; 
        
        try { 
            const res = await fetch(SCRIPT_URL); 
            const data = await res.json(); 
            const currentTaken = {};
            data.forEach(row => {
                if(row[0] && row[1] && !isNaN(row[0])) currentTaken[row[0].toString()] = row[1];
            });

            const conflict = selectedSquares.find(id => currentTaken[id]);
            if (conflict) {
                alert(`‚ö†Ô∏è QUICK MOVE! Square #${conflict} was just reserved by someone else while you were browsing.\n\nTo keep everything accurate, the board will refresh. Please pick your remaining squares again!`);
                overlay.style.display = 'none';
                loadBoard(); 
                selectedSquares = []; 
                updateCheckoutUI();
                return;
            }

            const payload = JSON.stringify({ apiKey: SECRET_API_KEY, squareId: selectedSquares.join(','), name, email }); 
            await fetch(SCRIPT_URL, { method: "POST", mode: 'no-cors', body: payload }); 
            alert("SUCCESS! Please send e-transfer to PFCBOYS09@GMAIL.COM"); 
            location.reload(); 
        } catch (e) { alert("Connection error. Please try again."); overlay.style.display = 'none'; } 
    }

    function createSq(txt, cls, col) { 
        const d = document.createElement('div'); 
        d.className = `sq ${cls}`; d.innerText = txt; 
        if (col) d.style.color = col; 
        return d; 
    }

    function updatePot() { 
        const count = Object.keys(takenSquares).length; 
        const total = (count * 20) * 0.5; 
        document.getElementById('total-pot').innerText = `$${total.toFixed(2)}`; 
        document.getElementById('quarter-payout').innerText = `$${(total/4).toFixed(2)}`; 
    }
    
    setInterval(() => { 
        const now = new Date().getTime() + worldTimeOffset; 
        const t = kickoffTime - now; 
        if (t > 0) { 
            const d = Math.floor(t/86400000); const h = Math.floor((t%86400000)/3600000); 
            const m = Math.floor((t%3600000)/60000); const s = Math.floor((t%60000)/1000); 
            document.getElementById("game-countdown").innerHTML = `YOUR SQUARE. YOUR GAME.         THE GAME BOARD LOCKS AT KICKOFF<br><span class="timer-highlight">${d}d ${h}h ${m}m ${s}s</span> UNTIL KICKOFF`; 
        } else { document.getElementById("game-countdown").innerText = "üèà GAME TIME!"; } 
    }, 1000);

    function adminAuth() { 
        clickCount = 0; const pw = prompt("Admin Password:"); if (pw === null) return;
        const actionInput = prompt("Type 'LOCK', 'UNLOCK', or 'RESET':"); if (actionInput === null) return;
        const action = actionInput.toUpperCase(); if (['LOCK', 'UNLOCK', 'RESET'].includes(action)) { adminAction(action, pw); } 
    }

    async function adminAction(type, password) { 
        const overlay = document.getElementById('loading-overlay'); overlay.style.display = 'flex'; 
        const s = () => [0,1,2,3,4,5,6,7,8,9].sort(() => Math.random() - 0.5); 
        let seahawks = (type === "LOCK") ? s() : Array(10).fill("?"); 
        let pats = (type === "LOCK") ? s() : Array(10).fill("?"); 
        const payload = { apiKey: SECRET_API_KEY, admin: true, action: type, password, seahawks, pats }; 
        try { 
            const response = await fetch(SCRIPT_URL, { method: "POST", body: JSON.stringify(payload) }); 
            const result = await response.text();
            if (result.includes("UNAUTHORIZED")) { alert("‚ùå Incorrect Password."); overlay.style.display = 'none'; } 
            else { alert("‚úÖ " + type + " command successful!"); location.reload(); }
        } catch (e) { location.reload(); } 
    }
    window.onload = async () => { await syncTime(); loadBoard(); };
</script>
</body>
</html>