<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PFC 2009 Boys - Super Bowl Squares</title>
    <style>
        :root { 
            --pfc-green: #00843D; 
            --pfc-dark: #005a2a;
            --sb-gradient: linear-gradient(135deg, #FF007F, #702963, #0077B6, #ffd700);
            --bg-light: #f8fafc;
        }
        body { font-family: 'Inter', -apple-system, sans-serif; background: var(--bg-light); margin: 0; padding: 20px 10px 120px 10px; color: #1e293b; }
        .container { max-width: 900px; margin: auto; background: white; padding: 30px; border-radius: 24px; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); border: 1px solid #e2e8f0; }
        
        header { margin-bottom: 30px; }
        h1 { color: var(--pfc-green); margin: 0; font-size: 2.5rem; letter-spacing: -1px; }
        .subtitle { font-weight: 600; color: #64748b; text-transform: uppercase; letter-spacing: 1px; margin-top: 5px; }

        /* Modern Progress Bar */
        .prog-wrapper { margin: 25px 0; text-align: left; }
        .prog-label { display: flex; justify-content: space-between; font-weight: bold; margin-bottom: 8px; font-size: 14px; }
        .progress-container { width: 100%; background: #f1f5f9; border-radius: 50px; height: 16px; overflow: hidden; border: 1px solid #e2e8f0; }
        .progress-bar { height: 100%; background: var(--pfc-green); width: 0%; transition: width 1.5s cubic-bezier(0.1, 0, 0, 1); }

        /* The Grid */
        .grid { display: grid; grid-template-columns: repeat(11, 1fr); gap: 4px; background: #f1f5f9; padding: 6px; border-radius: 12px; margin: 20px 0; }
        .sq { aspect-ratio: 1; background: white; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; cursor: pointer; border-radius: 4px; transition: all 0.2s; border: 1px solid #e2e8f0; }
        .sq:hover:not(.taken):not(.head-sq):not(.num-sq) { transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,0.1); border-color: var(--pfc-green); }
        
        .head-sq { background: var(--pfc-green); color: white; cursor: default; font-size: 9px; }
        .num-sq { background: #1e293b; color: white; cursor: default; font-size: 16px; border: none; }
        .taken { background: #f1f5f9; color: #94a3b8; cursor: not-allowed; font-size: 8px; border: none; font-weight: 400; }
        .selected { background: #ffd700 !important; color: #000; border: 2px solid #000; transform: scale(1.1); z-index: 10; }
        
        /* Floating Checkout */
        .checkout-bar { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #1e293b; color: white; padding: 15px 30px; border-radius: 50px; display: flex; gap: 25px; align-items: center; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.4); z-index: 100; display: none; border: 1px solid rgba(255,255,255,0.1); }
        .btn-confirm { background: var(--pfc-green); color: white; border: none; padding: 10px 20px; border-radius: 25px; font-weight: bold; cursor: pointer; transition: background 0.2s; }
        .btn-confirm:hover { background: var(--pfc-dark); }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>PICKERING FC</h1>
        <div class="subtitle">2009 Boys Super Bowl Fundraiser ‚Ä¢ $20/Square</div>
    </header>
    
    <div class="prog-wrapper">
        <div class="prog-label">
            <span>Fundraising Progress</span>
            <span id="prog-val">0%</span>
        </div>
        <div class="progress-container">
            <div id="myBar" class="progress-bar"></div>
        </div>
    </div>

    <div id="status" style="font-size: 12px; margin-bottom: 10px; color: #64748b;">üì° Connecting to Sheet...</div>
    <div id="game-board" class="grid"></div>
</div>

<div id="checkout" class="checkout-bar">
    <div style="font-size: 14px;">Selected: <b id="count">0</b></div>
    <div style="font-size: 14px;">Total: <b id="total" style="color: #fbbf24;">$0</b></div>
    <button class="btn-confirm" onclick="checkout()">Reserve Now</button>
</div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzHUIWFce4Xb1HI3nW1toacZiEI4HK6nfsph5oZovGslcdhkOZMaVj_vcT8rPGrE6qd/exec";
    let selectedSquares = [];
    let takenSquares = {};

    async function loadBoard() {
        try {
            const response = await fetch(SCRIPT_URL);
            const sheetData = await response.json();
            takenSquares = {};
            sheetData.forEach(row => { if(row[0]) takenSquares[row[0].toString()] = row[1]; });
            updateProgress(Object.keys(takenSquares).length);
            document.getElementById('status').innerHTML = "üü¢ Board Live";
        } catch (e) {
            document.getElementById('status').innerText = "‚ö†Ô∏è Connection Error";
        }
        renderBoard();
    }

    function updateProgress(soldCount) {
        const percent = Math.min((soldCount / 100) * 100, 100);
        document.getElementById('myBar').style.width = percent + "%";
        document.getElementById('prog-val').innerText = soldCount + " / 100 Sold";
    }

    function renderBoard() {
        const board = document.getElementById('game-board');
        board.innerHTML = "";
        for (let i = 0; i < 121; i++) {
            const d = document.createElement('div');
            d.className = 'sq';
            if (i === 0) { d.innerText = "AFC/NFC"; d.classList.add('head-sq'); }
            else if (i < 11 || i % 11 === 0) { d.innerText = "?"; d.classList.add('num-sq'); }
            else {
                if (takenSquares[i]) { d.innerText = takenSquares[i]; d.classList.add('taken'); }
                else {
                    d.onclick = () => toggleSquare(i, d);
                    if (selectedSquares.includes(i)) d.classList.add('selected');
                }
            }
            board.appendChild(d);
        }
    }

    function toggleSquare(id, el) {
        if (selectedSquares.includes(id)) {
            selectedSquares = selectedSquares.filter(s => s !== id);
            el.classList.remove('selected');
        } else {
            selectedSquares.push(id);
            el.classList.add('selected');
        }
        updateBar();
    }

    function updateBar() {
        const bar = document.getElementById('checkout');
        const count = selectedSquares.length;
        document.getElementById('count').innerText = count;
        document.getElementById('total').innerText = "$" + (count * 20);
        bar.style.display = count > 0 ? 'flex' : 'none';
    }

    async function checkout() {
        const name = prompt("Enter First & Last Name:");
        const email = prompt("Enter Email Address:");
        if (!name || !email) return;

        const totalAmount = selectedSquares.length * 20;
        if (confirm(`Confirm $${totalAmount} for ${selectedSquares.length} squares?`)) {
            document.getElementById('status').innerText = "‚åõ Securing Squares...";
            for (let id of selectedSquares) {
                await fetch(SCRIPT_URL, {
                    method: "POST",
                    mode: 'no-cors',
                    body: JSON.stringify({ squareId: id, name: name, email: email })
                });
            }
            alert(`SUCCESS! We've held your squares.\n\nPlease e-Transfer $${totalAmount} to PFCBOYS09@GMAIL.COM to finalize.`);
            selectedSquares = [];
            updateBar();
            loadBoard();
        }
    }
    loadBoard();
</script>
</body>
</html>